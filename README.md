# Employee Search API

Search-only FastAPI microservice for an HR employee directory with:
- **Org-level dynamic columns** (prevent data leak; whitelist projection)
- **Strict org isolation**
- **Custom sliding-window rate limiting** (stdlib only)
- **Auto-seeded mock data** (hundreds of employees auto-generated)
- **OpenAPI docs** (FastAPI)
- **Containerized** (Docker)
- **Unit tests** (pytest)

> Built according to the assignment brief.

---

## üöÄ Quickstart

### Run via Docker

```bash
# 1) Build the image
docker build -t employee-search .

# 2) Run the container
docker run --rm -p 8000:8000 employee-search
```

Then open: [http://localhost:8000/docs](http://localhost:8000/docs)

---

### Run Locally (without Docker)

```bash
python3 -m venv venv
source venv/bin/activate     # or venv\Scripts\activate on Windows
pip install -r requirements.txt

# Start server
uvicorn app.main:app --reload --port 8000
```

When started, you‚Äôll see something like:

```
INFO:     Uvicorn running on http://127.0.0.1:8000
[INFO] Seeded 600 mock employees across 3 orgs.
```

That means the mock data was auto-generated and ready for search.

---

## üß† Mock Data

The system automatically seeds **3 organizations √ó 200 employees each** with random:
- names, emails, and phone numbers  
- departments, positions, and locations  
- years of experience  
- random skill combinations  

> You can adjust the quantity by editing `_seed(num_orgs, per_org)` in `app/database.py`.

---

## üîç Endpoints

### `GET /api/v1/employees/search`

#### Query Parameters

| Key | Type | Description |
|-----|------|--------------|
| org_id | int | **Required.** Organization ID (1‚Äì3 default). |
| q | string | Free-text search (matches name, email, skills, etc.) |
| department | string | Filter by department |
| location | string | Filter by location |
| position | string | Filter by position |
| email | string | Filter by email |
| phone | string | Filter by phone |
| skills | string | Comma-separated list of skills |
| min_years | float | Minimum years of experience |
| max_years | float | Maximum years of experience |
| page | int | Page number (default 1) |
| limit | int | Results per page (default 20, max 200) |

#### Example Request
```
GET http://localhost:8000/api/v1/employees/search?org_id=1&q=john&position=Engineer&limit=5
```

#### Example Response
```json
{
  "data": [
    {
      "name": "John Smith",
      "department": "Engineering",
      "location": "London",
      "position": "Engineer",
      "email": "john.smith@org1.com"
    }
  ],
  "meta": {
    "total": 47,
    "page": 1,
    "limit": 5,
    "visible_columns": ["name","department","location","position","email"]
  }
}
```

---

## ‚ö° Rate Limiting

- Sliding window: **30 requests per 60 seconds per client**  
- Client identity is determined by:
  - `X-API-Key` header (if provided)
  - or fallback to IP address

**Error on exceeding limit:**
```json
{
  "detail": "Rate limit exceeded"
}
```

---

## üß™ Testing with Postman

1. **Base URL:** `http://localhost:8000/api/v1/employees/search`
2. **Method:** `GET`
3. **Params Example:**
   | Key | Value |
   |-----|-------|
   | org_id | 1 |
   | q | john |
   | position | Engineer |
   | limit | 5 |
4. *(Optional)* Add header: `X-API-Key: my-demo-key`  
5. Click **Send** ‚Üí You‚Äôll receive seeded employee data instantly.

---

## üß© Swagger UI

Interactive docs available at:

üëâ [http://localhost:8000/docs](http://localhost:8000/docs)

Use it to test endpoints and see OpenAPI schema automatically generated by FastAPI.

---

## üß± Running Tests

To validate the codebase and rate limiter behavior:

```bash
pytest -q
```

---

## ‚öôÔ∏è Notes

- Uses an in-memory mock database with instant auto-seeding.  
- No external libraries are used for rate-limiting logic.  
- The service is stateless ‚Äî data resets each time you restart the server.  
- Extend or adjust mock data in `app/database.py` as needed.

---

## ‚úÖ Example Queries

**1Ô∏è‚É£ Search by name**
```
GET http://localhost:8000/api/v1/employees/search?org_id=1&q=alex
```

**2Ô∏è‚É£ Filter by department and location**
```
GET http://localhost:8000/api/v1/employees/search?org_id=1&department=HR&location=London
```

**3Ô∏è‚É£ Search employees with Python + AWS skills**
```
GET http://localhost:8000/api/v1/employees/search?org_id=2&skills=python,aws
```

**4Ô∏è‚É£ Paginate results**
```
GET http://localhost:8000/api/v1/employees/search?org_id=3&page=2&limit=10
```

**5Ô∏è‚É£ Test rate limit**
Use Postman Runner or spam refresh quickly ‚Äî after ~30 requests in 1 min, API returns 429.

---

## üèÅ Summary

This microservice demonstrates:
- Clean FastAPI architecture
- Dynamic organization-specific field projection
- Custom-built rate limiting (no external libs)
- Auto-generated mock HR data
- High performance and isolation between orgs
